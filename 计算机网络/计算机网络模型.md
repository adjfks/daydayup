# 计算机网络模型

## 概述

计算机网络模型有七层、五层和四层模型。

七层网络模型是指国际标准化组织制定OSI网络模型，它是一个大而圈的网络系统，由于其理论太复杂，所以只是概念上的分层，并没有具体的实现方案。

四层模型是从实际的应用出发，侧重于一些核心分层，TCP/IP网络模型就是最常用且实用的四层模型。

五层只出现在计算机网络学习教学过程中，他是对七层模型和四层模型的一个折中。





## 为什么需要分层

因特网是一个极其复杂的系统，它的组成包括了各种各样的应用程序和协议、各种端系统和交换机，各种类型的链路级媒体。

面对这样一个系统我会怎么做呢？作为理工科的我自然而然想到进行模块划分。首先根据不同的功能，先从整体上把这个系统划分为一个一个的模块，并且考虑各个模块之间的联系。

实际上就是采用了类似的思想，即采用分层来组织网络体系，每一层都有特定的功能，并且向上提供服务。每一层包含一些协议，各层的协议组合起来变成协议栈，所谓的4层、5层、7层说的就是这个协议栈的层数。





## 分为哪几层

OSI包括7层，自顶向下分别是：

- 应用层

- 表示层

- 会话层

- 传输层

- 网络层

- 数据链路层

- 物理层

五层模型一般出现在书籍和教学中，原因是它能比较清晰间接地阐述相关概念，自顶向下包括以下5层：

- 应用层

- 运输层

- 网络层

- 链路层

- 物理层

四层模型即TCP/IP模型是我们实际应用的分层，自顶向下包括：

- 应用层

- 传输层

- 网络层

- 网络接口层





## 应用层

应用层是分层模型中的最顶层，是与通信双方最为接近的一层。想想我们平时是如何上网的，例如打开浏览器浏览网页。这就说明了我们需要在应用层编写程序来实现通信。一般有两种形式的程序：一个是client-server，客户端和服务端之间进行通信，如果是端到端的通信也需要借助服务端间接通信。另一个就是P2P，即端主机之间直接进行通信。



实际上实现通信的并不是应用程序，而是进程。两个系统之间的通信实际上是两个进程之间的通信。进程又通过一个叫做socket（套接字）的软件与计算机网络实现通信，socket实际上就是一些API。

两台主机通过IP地址得知对方的位置，两台主机上的进程通过端口号来讲对方与其他进程区分。



应用层协议定义了不同主机上的两个进程之间如何收发报文。我们平常使用最多的应用层协议就是HTTP协议。

HTTP即超文本传输控制协议，需要实现两个应用程序：一个客户程序和一个服务程序。

HTTP是由TCP提供传输层支撑。TCP能够保证发送的报文或响应能够正确地被对方接收。在开发应用程序时，我们需要根据自己的需求选择**持续连接和非持续连接。**

**持续连接**是指一个客户端和服务端之间的通信经过相同的TCP连接进行请求和响应的收发。

**非持续连接**是指每个请求或响应都通过单独的一条TCP连接进行收发。

HTTP在默认方式下使用持续连接，但是我们也可以进行配置。



### 非持续连接

以请求一个HTML页面和页面上对应的10个图片资源为例，HTTP非持续连接的过程如下：

1. 客户端通过socket向服务端发送一个建立TCP连接的请求，发送一个小的TCP报文段

2. 服务器从socket得到该请求，发送一个小的TCP报文段向客户端作出确认和响应

3. 客户端向服务器返回确认。一条TCP连接建立。

4. 在返回确认的同时通过socket向服务器发送请求报文。

5. 服务器通过socket拿到该报文，将请求的资源从存储器取出，在响应报文中封装对象，然后通过soket将其发送给客户。

6. 服务器进程通知TCP断开TCP连接，但是直到TCP确认客户端接收到完整响应报文才会中断连接。

7. 客户端接收响应报文，TCP连接关闭。

客户端检查HTML文件，得到10个图片的引用，重复上面的步骤10次。

可以计算一下一次非持续TCP连接所花费的时间，总共需要2个RTT(一个RTT表示往返时间)加传输html的时间。





### 持续连接

TCP持续连接就是一条TCP连接上可以有多个请求和响应，而且一个接一个地发送请求而不必一定要等到响应返回。通过可配置的超时间隔，我们可以控制这条TCP连接在多久未使用的情况下断开。





### DNS

DNS即域名系统。

这个域名系统由许多的DNS服务器组成，这些服务器是分层的，它们共同实现了一个分布式数据库。同时这个域名系统还包括一个使得主机能够查询该数据库的协议。一台DNS服务器其实就是运行BIND软件的一个UNIX机器。DNS协议运行在UDP之上，使用53号端口。

DNS提供的功能就是把主机名解析为IP地址。



**DNS服务器除了将主机名解析为IP地址，还有哪些功能呢？**

1. **主机别名**

它允许一个IP地址的主机对应多个别名，通常有一个规范主机名和其他的别名，无论是接收到哪个别名，DNS服务器都能将它们解析为一个唯一的IP地址。

2. **邮件服务器别名**

能够对提供的邮件服务器别名进行解析，得到相应的规范主机名和IP地址。它甚至还允许一个公司的web服务器和邮件服务器拥有相同的别名。

3. **负载分配**

一个站点可能被分配在多台服务器上，每台服务器运行在不同的端系统上，拥有不同的IP地址。也就是说主机名与多个IP地址对应。DNS数据库能够存储这个IP地址集合，在接收到客户端的DNS请求时，用这个集合作为响应，但是在回答时循环这些IP地址次序，而客户端通常是向排在最前面的IP地址发起请求，因此DNS服务器在这些web服务器之间循环分配了负载。





客户端主机上的进程要进行DNS查询时会调用自己主机上的DNS并指明要转换的主机名，然后该DNS接收后，从53号端口发送UDP数据报，经过一段时延后得到回答报文，然后将结果传递给该进程。



由于因特网十分庞大，不可能只使用一台DNS服务器，因此实际中实现了DNS分布式系统。由许许多多的DNS服务器组成。DNS服务器分为3类：**根域DNS、顶级域（TLD,Top-level Domain）DNS、权威DNS。**



以`www.example.com`为例，其实省略了最后面的一个点，即`www.example.com.`，根域就是最后的这个`.`，顶级域就是`.com`，还有其他诸如`.org .net`等。权威域



举个例子，例如我们要查www.example.com这个域名的IP地址，首先会去根域服务器查顶级域名`.com`的TLD服务器的IP地址，然后客户端与这些TLD服务器的其中之一建立联系，它将返回`example.com`的权威服务器的地址。最后与其中一台权威服务器建立联系，返回得到主机名`www.example.com`的IP地址。



**DNS记录**

我们在购买一个域名之后，例如我购买阿里云的域名，接下来就要去在阿里云控制台解析设置中配置DNS记录，记录中包含以下类型：

TTL：该记录的生存时间，决定该记录在DNS缓存中的存在时间。

1. A记录：name为主机名，如`blog.victorcoding.top`，value为主机IP地址。

2. NS记录：name是个域，value指定权威DNS服务器的IP地址。

3. CNAM: name是主机的别名，value是规范主机名。比如name是`victorcoding.top`，value是`adjfks.github.io`







## 传输层
